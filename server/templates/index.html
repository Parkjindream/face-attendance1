<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Face Dashboard</title>
  <link rel="stylesheet" href="/static/css/style.css" />
<style>
/* ===== Base & Layout ===== */
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}
body {
  font-family: 'Poppins', sans-serif;
  background: #f7f8fa;
  color: #222;
  display: flex;
  min-height: 100vh;
  transition: background 0.3s ease;
}
a {
  text-decoration: none;
  color: inherit;
}

/* ===== Sidebar ===== */
.sidebar {
  width: 260px;
  background: #fff;
  border-right: 1px solid #eee;
  box-shadow: 4px 0 10px rgba(0,0,0,0.05);
  flex-shrink: 0;
  display: flex;
  flex-direction: column;
  transition: width 0.3s ease;
}
.sidebar.collapsed { width: 75px; }

.logo {
  text-align: center;
  padding: 1.5rem 0;
  font-size: 1.4rem;
  font-weight: bold;
  display: flex;
  flex-direction: column;
  align-items: center;
  color: #ff4fa3;
}
.logo img {
  width: 50px;
  height: 50px;
  margin-bottom: 0.6rem;
  transition: transform 0.3s ease;
}
.logo img:hover { transform: rotate(10deg) scale(1.08); }

/* ===== Menu ===== */
.menu {
  flex: 1;
  display: flex;
  flex-direction: column;
  margin-top: 1rem;
}
.menu button {
  background: none;
  border: none;
  color: #444;
  padding: 0.75rem 1rem;
  text-align: left;
  display: flex;
  align-items: center;
  gap: 0.6rem;
  cursor: pointer;
  font-size: 1rem;
  border-radius: 12px;
  margin: 4px 10px;
  transition: all 0.3s ease;
}
.menu button:hover, .menu button.active {
  background: linear-gradient(135deg, rgba(255,79,163,0.15), rgba(255,79,163,0.05));
  color: #ff4fa3;
  transform: translateX(6px);
  box-shadow: 0 2px 8px rgba(255,79,163,0.2);
}

/* ===== Toggle ===== */
.toggle-btn {
  background: #ff4fa3;
  border: none;
  color: #fff;
  padding: 0.75rem;
  margin: 1rem;
  border-radius: 12px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.3s ease;
}
.toggle-btn:hover {
  background: #ff6fb8;
  transform: scale(1.05);
}

/* ===== Main ===== */
main {
  flex: 1;
  padding: 1.8rem;
  overflow: auto;
}
header.topbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1.5rem;
  flex-wrap: wrap;
}
header.topbar h1 {
  font-size: 1.6rem;
  font-weight: 700;
  color: #222;
}
.status {
  font-size: 0.95rem;
  color: #ffffffff;
}

/* ===== Badge ===== */
.badge {
  display: inline-block;
  padding: 0.3rem 0.8rem;
  border-radius: 999px;
  font-size: 0.85rem;
  border: 1px solid transparent;
  transition: all 0.3s ease;
}
.badge.on {
  background: #16c47f;
  color: #fff;
  border-color: #16c47f;
}
.badge.off {
  background: #fce4ef;
  color: #ff4fa3;
  border-color: #ff4fa3;
}

/* ===== Tab Panels ===== */
.tab-panel {
  display: none;
  opacity: 0;
  transform: translateY(10px);
  transition: all 0.4s ease;
}
.tab-panel.active {
  display: block;
  opacity: 1;
  transform: translateY(0);
}

/* ===== Cards ===== */
.card, .camera-card, .attendance-card {
  background: #fff;
  padding: 1.5rem;
  border-radius: 18px;
  box-shadow: 0 8px 18px rgba(0,0,0,0.05);
  margin-bottom: 1.5rem;
  transition: all 0.3s ease;
}
.card:hover {
  transform: translateY(-4px);
  box-shadow: 0 10px 25px rgba(255,79,163,0.15);
}

/* ===== Forms ===== */
form label {
  display: block;
  margin-top: 0.75rem;
  margin-bottom: 0.25rem;
  font-weight: 600;
  color: #333;
}
form input, form button {
  padding: 0.65rem;
  border-radius: 10px;
  border: 1px solid #ccc;
  width: 100%;
  transition: all 0.3s ease;
}
input::placeholder { color: #aaa; }
form input:focus {
  border-color: #ff4fa3;
  box-shadow: 0 0 8px rgba(255,79,163,0.3);
  outline: none;
}
form button {
  background: #ff4fa3;
  color: #fff;
  border: none;
  margin-top: 0.6rem;
  cursor: pointer;
  font-weight: 600;
}
form button:hover {
  background: #ff6fb8;
  transform: scale(1.03);
}

/* ===== Table ===== */
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 0.8rem;
  border-radius: 12px;
  overflow: hidden;
}
thead {
  background: #ff4fa3;
  color: #fff;
}
th, td {
  padding: 0.7rem 1rem;
  text-align: center;
  border-bottom: 1px solid #f2f2f2;
}
tbody tr:nth-child(even) {
  background: #fafafa;
}
tbody tr:hover {
  background: #ffe6f1;
  transition: 0.3s;
}

/* ===== Camera Section ===== */
.camera-wrapper {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
  gap: 1.2rem;
}
.camera-view {
  width: 100%;
  border-radius: 16px;
  border: 3px solid #ff4fa3;
  box-shadow: 0 8px 20px rgba(255,79,163,0.15);
  transition: transform 0.3s ease;
}
.camera-view:hover { transform: scale(1.02); }

/* ===== Utilities ===== */
.row {
  display: flex;
  flex-wrap: wrap;
  gap: 0.7rem;
  align-items: center;
  justify-content: space-between;
}
.hint {
  font-size: 0.85rem;
  color: #888;
  margin-top: 0.5rem;
}

/* ===== Responsive ===== */
@media (max-width: 768px) {
  .sidebar {
    position: fixed;
    left: -260px;
    top: 0;
    bottom: 0;
    z-index: 1000;
    height: 100%;
  }
  .sidebar.collapsed { left: 0; }
  main { padding: 1rem; }
  .camera-wrapper { grid-template-columns: 1fr; }
}

</style>






</head>

<body>
  <!-- ===== Sidebar ===== -->
  <aside class="sidebar" id="sidebar">
    <div  class="logo">
      <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR7Zm15LImGZ4DcerJW3F-_-pvGyLCN-vQs9g&s" alt="Logo">
      <span class="logo-text">‡∏•‡∏≤‡∏î‡∏Å‡∏£‡∏∞‡∏ö‡∏±‡∏á</span>
    </div>
    <div class="menu">
      <button class="tab active" data-tab="register">üìù Register</button>
      <button class="tab" data-tab="identify">üîç Identify</button>
      <button class="tab" data-tab="faces">üë§ Faces</button>
      <button class="tab" data-tab="camera">üìπ Camera</button>
      <button class="tab" data-tab="summary">üìä Summary</button>
      <button class="tab" data-tab="settings">‚öôÔ∏è Settings</button>
      <button class="tab" data-tab="backup">üíæ Backup</button>
    </div>
    <button class="toggle-btn" id="toggleSidebar">‚¨ÖÔ∏è</button>
  </aside>

  <!-- ===== Main Content ===== -->
  <main>
    <header style="color:white"; class="topbar">
      <h1 style="color:white";>‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡∏î‡πâ‡∏ß‡∏¢‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÇ‡∏Ñ‡∏ï‡∏£‡πÄ‡∏ó‡πà</h1>
      <div class="status">
        <span id="regCount">‚Ä¶</span> ‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô ‚Ä¢
        ‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏ä‡πá‡∏Ñ: <span id="windowTime">--:-- ‚Äì --:--</span> ‚Ä¢
        ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏≠‡∏ö: <span id="activeBadge" class="badge off">‡∏´‡∏¢‡∏∏‡∏î</span>
      </div>
    </header>

    <!-- Register Tab -->
    <section class="tab-panel active" id="panel-register">
      <div class="card">
        <h2>‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤</h2>
        <form id="registerForm" enctype="multipart/form-data">
          <label>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
          <input type="text" name="name" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠..." required />
          <label>‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</label>
          <input type="text" name="student_id" placeholder="‡πÄ‡∏ä‡πà‡∏ô 65xxxxxxx (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)" />
          <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</label>
          <input type="file" name="file" accept="image/*" required />
          <button type="submit">Register / Update</button>
        </form>
        <pre class="result" id="registerResult"></pre>
        <p class="hint">* ‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏ï‡πà‡∏≠‡∏Ñ‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏î miss-match</p>
      </div>
    </section>

    <!-- Identify Tab -->
    <section class="tab-panel" id="panel-identify">
      <div class="card">
        <h2>‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡∏à‡∏≤‡∏Å‡∏†‡∏≤‡∏û</h2>
        <form id="identifyForm">
          <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</label>
          <input type="file" name="file" accept="image/*" required />
          <label>tolerance (0.3‚Äì0.8)</label>
          <input type="number" step="0.01" min="0.3" max="0.8" name="tolerance" value="0.6" />
          <button type="submit">Identify</button>
        </form>
        <pre class="result" id="identifyResult"></pre>
      </div>
    </section>

    <!-- Faces Tab -->
    <section class="tab-panel" id="panel-faces">
      <div class="card">
        <div  class="row">
          <h2>‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</h2>
          <button id="refreshFaces">Refresh</button>
        </div>
        <ul class="face-list" id="facesList"></ul>
      </div>
    </section>

    <!-- Camera Tab -->
    <section class="tab-panel" id="panel-camera">
      <div class="camera-wrapper">
        <div class="camera-card card">
          <h3>‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏•‡πâ‡∏≠‡∏á</h3>
          <img id="camStream" src="/video_feed" class="camera-view" />
          <div class="hint">* ‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏≤‡∏î‡∏ß‡∏á‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏£‡∏≠‡∏ö‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö ‡πÅ‡∏•‡∏∞‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ</div>
        </div>
        <div class="attendance-card card">
          <h3>üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠ </h3>
          <table class="attendance-table">
            <thead><tr><th>‡πÄ‡∏ß‡∏•‡∏≤</th><th>‡∏ä‡∏∑‡πà‡∏≠</th><th>‡∏£‡∏´‡∏±‡∏™</th></tr></thead>
            <tbody id="attendanceList"></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- Summary Tab -->
    <section class="tab-panel" id="panel-summary">
      <div class="card">
        <div class="row">
          <h2>‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤</h2>
          <button id="btnLoadSummary">Refresh Summary</button>
        </div>
        <table class="table" style="margin:.5rem 0 1rem 0;">
          <thead><tr><th>‡∏ä‡∏∑‡πà‡∏≠</th><th>‡∏£‡∏´‡∏±‡∏™</th><th>‡∏ô‡∏±‡∏ö(‡∏Ñ‡∏£‡∏±‡πâ‡∏á)</th></tr></thead>
          <tbody id="summaryTbody"></tbody>
        </table>
        <pre class="result" id="summaryBox"></pre>
        <div class="row" style="margin:.5rem 0;">
          <button id="btnExportTodayCsv">Export ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ (.csv)</button>
          <button id="btnExportTodayXlsx">Export ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ (.xlsx)</button>
          <label>Export ‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</label>
          <input type="date" id="exportDate" />
          <button id="btnExportByDateCsv">CSV</button>
          <button id="btnExportByDateXlsx">XLSX</button>
        </div>
      </div>
    </section>

    <!-- Settings Tab -->
    <section class="tab-panel" id="panel-settings">
      <div class="card">
        <h2>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠</h2>
        <form id="timeForm">
          <label>‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°</label>
          <input type="time" name="start" required />
          <label>‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</label>
          <input type="time" name="end" required />
          <button type="submit">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤</button>
        </form>
        <pre class="result" id="timeResult"></pre>
      </div>
    </section>

    <!-- Backup Tab -->
    <section class="tab-panel" id="panel-backup">
      <div class="card">
        <h2>Backup / Restore</h2>
        <button id="btnBackup">üì• ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î Backup</button>
        <form id="restoreForm" style="margin-top:.75rem;">
          <label>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå backup.zip</label>
          <input type="file" name="file" accept=".zip" required />
          <button type="submit">üì§ Restore</button>
        </form>
        <pre class="result" id="backupResult"></pre>
      </div>
    </section>
  </main>

  <script>
    /* ===== Sidebar Toggle ===== */
    const sidebar = document.getElementById('sidebar');
    const toggleBtn = document.getElementById('toggleSidebar');
    toggleBtn.addEventListener('click', () => {
      sidebar.classList.toggle('collapsed');
    });

    /* ===== Tabs ===== */
    document.querySelectorAll('.tab').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
        btn.classList.add('active');
        document.querySelector('#panel-' + btn.dataset.tab).classList.add('active');
      });
    });

    /* ===== API & Functions ===== */
    async function api(path, options={}) {
      const res = await fetch(path, options);
      const text = await res.text();
      try { return { ok: res.ok, data: JSON.parse(text) }; }
      catch { return { ok: res.ok, data: text }; }
    }
    function setRegCount(n){ document.getElementById('regCount').textContent = n; }

    /* ---------- Status ---------- */
    async function pollStatus() {
      const r = await api('/get_status');
      if (!r.ok) return;
      const st = r.data || {};
      document.getElementById('windowTime').textContent = `${st.start || '--:--'} ‚Äì ${st.end || '--:--'}`;
      const badge = document.getElementById('activeBadge');
      if (st.active) { badge.textContent='‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡πá‡∏Ñ'; badge.classList.replace('off','on'); }
      else { badge.textContent='‡∏´‡∏¢‡∏∏‡∏î'; badge.classList.replace('on','off'); }
    }
    setInterval(pollStatus, 5000); pollStatus();

    /* ---------- Register ---------- */
    document.getElementById('registerForm').addEventListener('submit', async e=>{
      e.preventDefault();
      const form=e.target; const fd=new FormData();
      fd.append('name',form.name.value.trim());
      fd.append('student_id',(form.student_id.value||'').trim());
      fd.append('file',form.file.files[0]);
      const r=await api('/register_face',{method:'POST',body:fd});
      document.getElementById('registerResult').textContent=JSON.stringify(r.data,null,2);
      if(r.ok&&r.data&&r.data.total_registered!==undefined)setRegCount(r.data.total_registered);
      loadFaces(); form.reset();
    });

    /* ---------- Identify ---------- */
    document.getElementById('identifyForm').addEventListener('submit', async e=>{
      e.preventDefault();
      const form=e.target; const fd=new FormData();
      fd.append('file',form.file.files[0]);
      const tol=parseFloat(form.tolerance.value||'0.6');
      const r=await api('/identify_face?tolerance='+tol,{method:'POST',body:fd});
      document.getElementById('identifyResult').textContent=JSON.stringify(r.data,null,2);
    });

    /* ---------- Faces ---------- */
    async function loadFaces(){
      const ul=document.getElementById('facesList'); ul.innerHTML='Loading...';
      const r=await api('/list_faces'); if(!r.ok){ul.textContent=r.data;return;}
      const faces=Array.isArray(r.data.registered_faces)?r.data.registered_faces:[]; 
      const nameToSid=(r.data&&r.data.map)?r.data.map:{};
      if(r.data&&typeof r.data.count!=='undefined')setRegCount(r.data.count);
      ul.innerHTML=faces.length? '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠':'';
      faces.forEach(name=>{const sid=nameToSid[name]||'-'; const li=document.createElement('li'); li.textContent=`${name} ‚Äî ‡∏£‡∏´‡∏±‡∏™: ${sid}`; ul.appendChild(li);});
    }
    document.getElementById('refreshFaces').addEventListener('click', loadFaces);
    loadFaces();

    /* ---------- Attendance ---------- */
    async function loadAttendance(){
      const r=await api('/attendance_logs?limit=50'); if(!r.ok) return;
      const logs=(r.data&&Array.isArray(r.data.logs))?r.data.logs:[];
      const tbody=document.getElementById('attendanceList'); tbody.innerHTML='';
      logs.slice(-30).reverse().forEach(item=>{
        const tr=document.createElement('tr');
        const sid=item.student_id||'-';
        tr.innerHTML=`<td>${item.time||''}</td><td>${item.name||''}</td><td>${sid}</td>`;
        tbody.appendChild(tr);
      });
    }
    setInterval(loadAttendance,3000); loadAttendance();

    /* ---------- Summary ---------- */
    document.getElementById('btnLoadSummary').addEventListener('click', async ()=>{
      const r=await api('/attendance_summary');
      const pre=document.getElementById('summaryBox');
      const tbody=document.getElementById('summaryTbody');
      if(!r.ok){pre.textContent=String(r.data); tbody.innerHTML='<tr><td colspan="3">‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏£‡∏∏‡∏õ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</td></tr>'; return;}
      pre.textContent=JSON.stringify(r.data,null,2);
      let rows=[]; const sum=r.data&&r.data.summary;
      if(Array.isArray(sum)) rows=sum.map(x=>({name:x.name||'', student_id:x.student_id||'-', count:Number(x.count||0)}));
      else if(sum&&typeof sum==='object'){
        let nameToSid={};
        try{const rf=await api('/list_faces'); if(rf.ok&&rf.data&&rf.data.map) nameToSid=rf.data.map;}catch{}
        rows=Object.entries(sum).map(([name,count])=>({name,student_id:nameToSid[name]||'-',count:Number(count||0)}));
      }
      tbody.innerHTML='';
      if(!rows.length) tbody.innerHTML='<tr><td colspan="3">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>';
      else rows.sort((a,b)=>b.count-a.count).forEach(row=>{const tr=document.createElement('tr'); tr.innerHTML=`<td>${row.name}</td><td>${row.student_id}</td><td>${row.count}</td>`; tbody.appendChild(tr);});
    });

    /* ---------- Time Setting ---------- */
    async function loadTimeSetting(){
      const r=await api('/get_attendance_time'); if(!r.ok) return;
      const form=document.getElementById('timeForm');
      if(r.data) { form.start.value=r.data.start||''; form.end.value=r.data.end||''; }
    }
    document.getElementById('timeForm').addEventListener('submit', async e=>{
      e.preventDefault(); const f=e.target;
      const r=await api('/set_attendance_time',{method:'POST',body:JSON.stringify({start:f.start.value,end:f.end.value}),headers:{'Content-Type':'application/json'}});
      document.getElementById('timeResult').textContent=JSON.stringify(r.data||r,true,2);
    });
    loadTimeSetting();

    /* ---------- Backup / Restore ---------- */
    document.getElementById('btnBackup').addEventListener('click', ()=>{window.location='/backup';});
    document.getElementById('restoreForm').addEventListener('submit', async e=>{
      e.preventDefault(); const f=e.target; const fd=new FormData(); fd.append('file',f.file.files[0]);
      const r=await api('/restore',{method:'POST',body:fd}); document.getElementById('backupResult').textContent=JSON.stringify(r.data,null,2);
    });
  </script>
</body>
</html>














